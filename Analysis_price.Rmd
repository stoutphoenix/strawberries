---
title: "Analysis"
author: "hyungu"
date: "2025-10-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}
library(ggplot2)
library(dplyr)
library(readr)

df <- read.csv("combined_data.csv")

avg_price <- df %>%
      group_by(state) %>%
      summarise(mean_price_overall = mean(price_overall, na.rm = TRUE))

    plot2 <- ggplot(data = avg_price, aes(x = reorder(state, -mean_price_overall), y = mean_price_overall, fill = state))+
      geom_col() + 
      labs(title = "Average Overall Price by State", 
           x = "State", 
           y = "Average Overall Price ($)") +
      theme_minimal() +
      theme(legend.position = "none") 

print(plot2)
```
```{r}
plot3 <- ggplot(data = df, aes(x = total_tonnage, y = price_overall, color = state, shape = state)) +
      geom_point(size = 3, alpha = 0.8) +
      labs(title = "Overall Price vs. Total Tonnage", 
           x = "Total Tonnage", 
           y = "Overall Price", 
           color = "State", 
           shape = "State") +
      theme_bw()
print(plot3)
```
```{r}
plot3_enhanced <- ggplot(data = df, aes(x = total_tonnage, y = price_overall)) +
  
  # 원본 산점도 (주별 색상 및 모양)
  geom_point(aes(color = state, shape = state), size = 3, alpha = 0.8) +
  
  # --- In-depth 분석 1: 주(state)별 추세선 (선형 회귀) ---
  # aes()에 color=state를 넣으면 state별로 다른 추세선이 그려집니다.
  geom_smooth(aes(color = state, group = state), 
              method = "lm",  # lm = Linear Model (선형 회귀)
              se = FALSE,     # se = FALSE (신뢰 구간 음영 제거)
              linewidth = 1) +
  
  
  labs(title = "Price vs. Tonnage with Regression Lines (by State)",
       x = "Total Tonnage", 
       y = "Overall Price ($)", 
       color = "State", 
       shape = "State") +
  theme_bw() +
  scale_y_continuous(labels = scales::comma) + # 축 서식 설정
  scale_x_continuous(labels = scales::comma)
print(plot3_enhanced)
```